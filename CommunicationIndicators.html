<head>
    <title>Communication Indicators and Forensics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="./styles/Common.css" />
    <link rel="stylesheet" href="./styles/Error.css" />
    <link rel="stylesheet" href="./styles/CommunicationIndicators.css" /> 
    
</head>
<body>
    <div class="alert hidden" id="alert" role="alert"></div>
    <div class="CIPage" id="cipage-1">
        <div class="fullName" id="fullName"></div>
        <div class="shorthand" , id="shorthand"></div>
        <div class="companyName" id="companyName"></div>

        <div class="communication-indicator-one-bar">
            <div class="title">1. ACCEPTANCE LEVEL</div>
            <div class="description">
                How does one view personal strengths and weaknesses? How much
                self-confidence does one have/display? How comfortable is one
                receiving compliments?
            </div>
            <div class="graph">
                <canvas class="canvas print-full acceptanceLevelChart"></canvas>
            </div>
            <div class="status bold acceptanceLevelStatus"></div>
            <div class="score acceptanceLevelScore"></div>
            <div
                class="life-language-1 life-language forensic acceptanceLevelLifeLanguage1"></div>
            <div
                class="life-language-2 life-language forensic acceptanceLevelLifeLanguage2"></div>
            <div
                class="life-language-3 life-language forensic acceptanceLevelLifeLanguage3"></div>
            <div
                class="life-language-4 life-language forensic acceptanceLevelLifeLanguage4"></div>
            <div
                class="life-language-5 life-language forensic acceptanceLevelLifeLanguage5"></div>
            <div
                class="life-language-6 life-language forensic acceptanceLevelLifeLanguage6"></div>
            <div
                class="life-language-7 life-language forensic acceptanceLevelLifeLanguage7"></div>
            <div class="comment forensic acceptanceLevelLifeLanguageComment">
                * Low unless experiencing career success or in the context of an
                area of domain knowledge or interest
            </div>
        </div>
        <div class="communication-indicator-three-bar alt-gray">
            <div class="title">2. INTERACTIVE STYLE</div>
            <div class="description">
                Prefer to work alone or in groups? Prefer to know people or meet
                new people easily?
            </div>
            <div class="subtitle-1 subtitle">Introvert</div>
            <div class="subtitle-2 subtitle">Balanced</div>
            <div class="subtitle-3 subtitle">Extrovert</div>
            <div class="graph-1">
                <canvas
                    class="print-one-third interactiveStyleIntrovertChart"></canvas>
            </div>
            <div class="graph-2">
                <canvas
                    class="print-one-third interactiveStyleBalancedChart"></canvas>
            </div>
            <div class="graph-3">
                <canvas
                    class="print-one-third interactiveStyleExtrovertChart"></canvas>
            </div>
            <div class="status bold interactiveStyleStatus"></div>
            <div class="score interactiveStyleScore"></div>
            <div
                class="life-language-1 life-language forensic interactiveStyleLifeLanguage1"></div>
            <div
                class="life-language-2 life-language forensic interactiveStyleLifeLanguage2"></div>
            <div
                class="life-language-3 life-language forensic interactiveStyleLifeLanguage3"></div>
            <div
                class="life-language-4 life-language forensic interactiveStyleLifeLanguage4"></div>
            <div
                class="life-language-5 life-language forensic interactiveStyleLifeLanguage5"></div>
            <div
                class="life-language-6 life-language forensic interactiveStyleLifeLanguage6"></div>
            <div
                class="life-language-7 life-language forensic interactiveStyleLifeLanguage7"></div>
        </div>
        <div class="communication-indicator-one-bar">
            <div class="title">3. INTERNAL CONTROL</div>
            <div class="description">
                How much self-control or self-government vs. impulsiveness or
                spontaneity does one display?
            </div>
            <div class="graph">
                <canvas class="print-full internalControlChart"></canvas>
            </div>
            <div class="status bold internalControlStatus"></div>
            <div class="score internalControlScore"></div>
            <div
                class="life-language-1 life-language forensic internalControlLifeLanguage1"></div>
            <div
                class="life-language-2 life-language forensic internalControlLifeLanguage2"></div>
            <div
                class="life-language-3 life-language forensic internalControlLifeLanguage3"></div>
            <div
                class="life-language-4 life-language forensic internalControlLifeLanguage4"></div>
            <div
                class="life-language-5 life-language forensic internalControlLifeLanguage5"></div>
            <div
                class="life-language-6 life-language forensic internalControlLifeLanguage6"></div>
            <div
                class="life-language-7 life-language forensic internalControlLifeLanguage7"></div>
            <div class="comment forensic">
                * Low unless focused an area of interest or research.
            </div>
        </div>
        <div class="communication-indicator-one-bar alt-gray">
            <div class="title">4. INTRUSION LEVEL</div>
            <div class="description">
                How well is one able to allow interruptions, changes,
                unsolicited opinions - anything one considers an intrusion -
                without moving to distress as a result?
            </div>
            <div class="graph">
                <canvas class="print-full intrusionLevelChart"></canvas>
            </div>
            <div class="status bold intrusionLevelStatus"></div>
            <div class="score intrusionLevelScore"></div>
            <div
                class="life-language-1 life-language forensic intrusionLevelLifeLanguage1"></div>
            <div
                class="life-language-2 life-language forensic intrusionLevelLifeLanguage2"></div>
            <div
                class="life-language-3 life-language forensic intrusionLevelLifeLanguage3"></div>
            <div
                class="life-language-4 life-language forensic intrusionLevelLifeLanguage4"></div>
            <div
                class="life-language-5 life-language forensic intrusionLevelLifeLanguage5"></div>
            <div
                class="life-language-6 life-language forensic intrusionLevelLifeLanguage6"></div>
            <div
                class="life-language-7 life-language forensic intrusionLevelLifeLanguage7"></div>
        </div>
        <div class="communication-indicator-one-bar">
            <div class="title">5. PROJECTIVE LEVEL</div>
            <div class="description">
                How important is the opinion of others? How much does one need
                or want positive feedback or respect? How much do I care about
                what you think of me?
            </div>
            <div class="graph">
                <canvas class="print-full projectiveLevelChart"></canvas>
            </div>
            <div class="status bold projectiveLevelStatus"></div>
            <div class="score projectiveLevelScore"></div>
            <div
                class="life-language-1 life-language forensic projectiveLevelLifeLanguage1"></div>
            <div
                class="life-language-2 life-language forensic projectiveLevelLifeLanguage2"></div>
            <div
                class="life-language-3 life-language forensic projectiveLevelLifeLanguage3"></div>
            <div
                class="life-language-4 life-language forensic projectiveLevelLifeLanguage4"></div>
            <div
                class="life-language-5 life-language forensic projectiveLevelLifeLanguage5"></div>
            <div
                class="life-language-6 life-language forensic projectiveLevelLifeLanguage6"></div>
            <div
                class="life-language-7 life-language forensic projectiveLevelLifeLanguage7"></div>
        </div>
        <div class="communication-indicator-one-bar alt-gray">
            <div class="title">6. SUSCEPTIBILITY TO STRESS</div>
            <div class="description">
                Stress happens to everyone and comes from various sources, even
                from having too many good things going on at one time. When
                dealing with problems or crisis do you tend to remain calm,
                excited, hyper-vigilant or reactive?
            </div>
            <div class="graph">
                <canvas class="print-full susceptibilityToStressChart"></canvas>
            </div>
            <div class="status bold susceptibilityToStressStatus"></div>
            <div class="score susceptibilityToStressScore"></div>
        </div>
        <div class="communication-indicator-three-bar">
            <div class="title">7. LEARNING PREFERENCE</div>
            <div class="description">
                There are three basic Learning styles--everyone learns in all
                three ways, but usually one will come more naturally to you, and
                you will have a preference for it if you have the choice.
            </div>
            <div class="subtitle-1 subtitle">Auditory</div>
            <div class="subtitle-2 subtitle">Visual</div>
            <div class="subtitle-3 subtitle">Physical</div>
            <div class="graph-1">
                <canvas
                    class="print-one-third learningPreferenceAuditoryChart"></canvas>
            </div>
            <div class="graph-2">
                <canvas
                    class="print-one-third learningPreferenceVisualChart"></canvas>
            </div>
            <div class="graph-3">
                <canvas
                    class="print-one-third learningPreferencePhysicalChart"></canvas>
            </div>
            <div class="status bold learningPreferenceAuditoryStatus"></div>
            <div class="score learningPreferenceAuditoryScore"></div>
            <div class="life-language-1"></div>
            <div
                class="bold life-language-2 life-language learningPreferenceVisualStatus"></div>
            <div
                class="life-language-3 life-language learningPreferenceVisualScore"></div>
            <div class="life-language-4"></div>
            <div
                class="life-language-5 life-language bold learningPreferencePhysicalStatus"></div>
            <div
                class="life-language-6 life-language learningPreferencePhysicalScore"></div>
            <div class="life-language-7"></div>
        </div>
        <div class="warning bold forensic">
            FOR COACH USE ONLY! DO NOT HAND OUT
        </div>
        <div class="footer">
            Copyright &copy; Life Languages International &#x2022; All rights
            reserved. &#x2022;
            <a href="www.lifelanguages.com">www.lifelanguages.com</a>
        </div>
    </div>

    <script type="module">
        import { ERROR } from "./modules/Error.js";
        import { DEBUG } from "./modules/Debug.js";
        import { displayCommunicationIndicators } from "./modules/CommunicationIndicators.js";
        import { convertCSVtoJSON } from "./modules/CSVToJSON.js";

        let url = new URL(window.location.href);

        // Test data generation
        //import { testSingle, testJSON, testCSV, testInvalidEntries } from './modules/CommunicationIndicators.test.js';
        //url = testSingle("https://www.relatematters.com/coaching-tools/CommunicationIndicators.html");
        //url = testJSON("https://www.relatematters.com/coaching-tools/CommunicationIndicators.html");
        //url = testCSV("https://www.relatematters.com/coaching-tools/CommunicationIndicators.html");
        //url = testInvalidEntries("https://www.relatematters.com/coaching-tools/CommunicationIndicators.html");

        try {
            function parseNumber(key, value) {
                if (typeof value == 'number')
                    return value;
                
                let nValue = parseFloat(value);
                if (Number.isNaN(nValue))
                    return value;
                return nValue;
            }

            function parseChar(key, value) {
                if (typeof value == 'string')
                    return value[0];
                return value;
            }
            
            function parseBool(key, value) {
                if (typeof value == 'boolean')
                    return value;
                
                if (typeof value == 'string') {
                    let cValue = value[0].toLowerCase();
                    return cValue == "y" || cValue == "t" || cValue == "1";
                }

                return value == 1;
            }
            
            function parseInteractiveStyle(key, value) {
                if (Array.isArray(value))
                    return value;
                
                // First part is a number
                let nValue = parseFloat(value);
                if (Number.isNaN(nValue)) {
                    return [ value, value ];
                }
                
                // Followed by an I, B, or E.
                return [nValue, value.slice(-1)];
            }

            const ciKeys = {
                mover: parseNumber,
                doer: parseNumber,
                responder: parseNumber,
                influencer: parseNumber,
                shaper: parseNumber,
                producer: parseNumber,
                contemplator: parseNumber,
                overallIntensity: parseNumber,
                acceptanceLevel: parseNumber,
                interactiveStyle: parseInteractiveStyle,
                interactiveStyleType: parseChar,
                interactiveStyleScore: parseNumber,
                internalControl: parseNumber,
                intrusionLevel: parseNumber,
                projectiveLevel: parseNumber,
                susceptibilityToStress: parseNumber,
                learningPreferenceAuditory: parseNumber,
                learningPreferenceVisual: parseNumber,
                learningPreferencePhysical: parseNumber,
                showForensics: parseBool
            };
            
            let searchParams = url.searchParams;
            let params = {};

            if (searchParams.has('json')) {
                params = JSON.parse(searchParams.get('json'));
            } else if (searchParams.has('csv')) {
                params = convertCSVtoJSON(searchParams.get('csv'));
            } else {
                for (const [key, value] of searchParams.entries()) {
                    params[key] = value;
                }
            }
            
            // We deal in arrays, so if the params are a singleton, enclose it in an array.
            if (!Array.isArray(params)) 
                params = [params];
            
        
            let ci = document.getElementById("cipage-1");
            // Loop over each page of information
            for (let i = 0; i < params.length; i++) {
                if (i > 0) {
                    // Create our page from the existing one
                    let divClone = ci.cloneNode(true); // the true is for deep cloning
                    divClone.setAttribute("id", "cipage-" + (i + 1));
                    document.body.appendChild(divClone);
                }
                try {
                    // Parse all the parameters, CSV and forms have strings for numbers, we need to convert them.
                    for (const key in params[i]) {
                        let value = params[i][key];
                        DEBUG.log('processing', key, value);
                        params[i][key] =
                        (key in ciKeys) ? ciKeys[key](key, value) : value;   
                    }
                    if ('interactiveStyle' in params[i]) {
                        // Combination of <number>[E|B|I] instead of individual parameters. Decompose.
                        params[i].interactiveStyleScore = params[i].interactiveStyle[0];
                        params[i].interactiveStyleType = params[i].interactiveStyle[1];
                        delete params[i].interactiveStyle;
                    }
                
                    DEBUG.log('params', JSON.stringify(params[i]));
                    displayCommunicationIndicators(i + 1, params[i]); 
                } catch (e) { 
                    ERROR.displayAlertInDoc(e); 
                }
            }
        } catch (e) {
            ERROR.displayAlertInDoc(e);
        }
    </script>
</body>